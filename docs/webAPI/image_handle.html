<!doctype html><html class="" data-reactroot=""><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="前端笔记"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">web图片处理 · Ding前端笔记</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><header><h1 class="hide_on_mobile"><a href="/">Ding前端笔记</a></h1><nav><ul><li class="show_on_mobile flex_center"><a class="czs-menu-l" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a></li><li class="show_on_mobile"><h1 class="mobile_title"><a href="/">Ding前端笔记</a></h1></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul></nav></header><aside class="sidebar"><ol class="list_style_none"><li class=""><a href="/index.html" class="nav_link">Hello world</a></li><li class="unfold"><a href="/WebAPI/README.md" class="nav_link">WebAPI/README.md<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"></ol></li><li class="unfold"><a href="/HTTP/index.html" class="nav_link">HTTP协议与浏览器<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/HTTP/browser.html" class="nav_link">浏览器</a></li><li class=""><a href="/HTTP/HTTP.html" class="nav_link">HTTP协议请求方法和状态码</a></li><li class=""><a href="/HTTP/internet-hardware.html" class="nav_link">网络硬件</a></li></ol></li><li class="unfold"><a href="/js/todo.md" class="nav_link">js/todo.md<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/js/basics.html" class="nav_link">JavaScript基础</a></li><li class=""><a href="/js/Object.html" class="nav_link">基础</a></li><li class=""><a href="/js/context.html" class="nav_link">执行上下文</a></li><li class=""><a href="/js/closure.html" class="nav_link">闭包和面向对象</a></li><li class=""><a href="/js/regex.html" class="nav_link">正则</a></li><li class=""><a href="/js/algo.html" class="nav_link">算法</a></li><li class=""><a href="/js/design-patterns.html" class="nav_link">JS设计模式</a></li></ol></li><li class="unfold"><a href="/TS/index.html" class="nav_link">TS<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/TS/basics.html" class="nav_link">TS基础</a></li><li class=""><a href="/TS/enum.html" class="nav_link">TS枚举 类型 接口 泛型</a></li></ol></li><li class="unfold"><a href="/vue/index.html" class="nav_link">Vue<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/vue/vue-skills.html" class="nav_link">Vue开发技巧</a></li><li class=""><a href="/vue/vue-communication.html" class="nav_link">Vue组件通信</a></li><li class=""><a href="/vue/vue-router/vue-router.html" class="nav_link">Vue路由</a></li></ol></li><li class=""><a href="/react/lifecycle.html" class="nav_link">React的生命周期</a></li><li class="unfold"><a href="/webpack/index.html" class="nav_link">Webpack<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/webpack/webpack-use.html" class="nav_link">webpack的使用</a></li><li class=""><a href="/webpack/webpack-principle.html" class="nav_link">Webpack打包原理解析</a></li><li class=""><a href="/webpack/webpack-dev-config.html" class="nav_link">生产环境配置</a></li><li class=""><a href="/webpack/webpack-custom-loader.html" class="nav_link">实现自己的loader</a></li><li class=""><a href="/webpack/webpack-custom-plugin.html" class="nav_link">实现自己的plugin</a></li><li class=""><a href="/webpack/webpack-split-chunks.html" class="nav_link">webpack代码分片</a></li><li class=""><a href="/webpack/webpack-dev-server-hmr.html" class="nav_link">webpack-dev-server 与 HMR</a></li></ol></li><li class=""><a href="/web-monitor/web-monitor.html" class="nav_link">前端监控简介</a></li><li class=""><a href="/git/git.html" class="nav_link">Git使用</a></li></ol></aside><section class="main"><div class="main_article"><article><h1>web图片处理</h1>
<h2 id="%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86blob--arraybuffer">图片处理Blob  ArrayBuffer<a class="anchor" href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86blob--arraybuffer">§</a></h2>
<h3 id="%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">本地图片<a class="anchor" href="#%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">§</a></h3>
<p>FileReader</p>
<p>readAsDataUrl</p>
<p>Base64 基于64个可打印字符，2的6次方，即为64。</p>
<p>三个字节，对应24比特，即4个可打印字符。</p>
<p>大小写字母各26各，数字10个，加号+和斜杠，共64个字符，等号=用来作为后缀。</p>
<p>字母 对应ASCII码</p>
<p>不能被3整除，需要补字节，A  QQ==  BC QKM=</p>
<p>btoa() 基于二进制数据创建一个base64编码的字符串</p>
<p>atob() 解码通过base64编码的字符串数据</p>
<h3 id="%E8%BF%9C%E7%A8%8B%E5%9B%BE%E7%89%87-%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88">远程图片-图片预览<a class="anchor" href="#%E8%BF%9C%E7%A8%8B%E5%9B%BE%E7%89%87-%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88">§</a></h3>
<p>解密图片时，可以考虑在Web Worker中使用fetch API获取图片数据并进行解密</p>
<p>fetch API 的Response对象，blob() json() text() formData()  arrayBuffer()</p>
<h4 id="object-url">Object URL<a class="anchor" href="#object-url">§</a></h4>
<p>URL.createObjectURL</p>
<p>URL.revokeObjectURL(url)</p>
<h4 id="blob-api">Blob API<a class="anchor" href="#blob-api">§</a></h4>
<p>size 字节大小</p>
<p>type MIME类型   text/html   image/png text/plain</p>
<pre class="language-autoit"><code class="language-autoit">new <span class="token function">Blob</span><span class="token punctuation">(</span>blobParts<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre>
<p>blobParts 由 ArrayBluffer ArrayBufferView  Blob DOMString等对象构成的数组，DOMString会被编码成UTF-8</p>
<p>options，type默认为“”，endings，结束符\n如何被写入，transparent，native更改为适合宿主操作系统的换行符</p>
<p>从类型化数组和字符串创建Blob</p>
<pre class="language-autoit"><code class="language-autoit">let hello <span class="token operator">=</span> new <span class="token function">Unit8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> 二进制格式的hello
let bolb <span class="token operator">=</span> new <span class="token function">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>hello<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tpype<span class="token punctuation">:</span><span class="token string">'text/html'</span><span class="token punctuation">)</span>
</code></pre>
<h5 id="bolb%E6%96%B9%E6%B3%95">Bolb方法<a class="anchor" href="#bolb%E6%96%B9%E6%B3%95">§</a></h5>
<p>slice([start[, end[, contentType]]]) 返回一个新的对象，包含了bolb原对象中指定范围内的数据。</p>
<p>stream() 返回一个能读取blob内容的ReadableSream</p>
<p>text 返回一个Promise对象且包含blob所有内容的UTF-8格式的USVString</p>
<p>arrayBuffer 返回一个Promise对象且包含blob所有内容的二进制格式的ArrayBuffer</p>
<h4 id="arraybuffer">ArrayBuffer<a class="anchor" href="#arraybuffer">§</a></h4>
<p>通用的 固定长度的原始二进制数据缓冲区，不能直接操作，需要通过类数组对象或DataView对象来操作。</p>
<pre class="language-autoit"><code class="language-autoit">new <span class="token function">ArrayBuffer</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> length字节大小，小于MATH<span class="token punctuation">.</span>MAX_SAFE_INTEGER <span class="token number">2</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">53</span>
</code></pre>
<h4 id="typedarray">TypedArray<a class="anchor" href="#typedarray">§</a></h4>
<p><strong>Uint8Array</strong></p>
<p>Uint8Array 数组类型表示⼀个 8 位⽆符号整型数组，创建时内容被初始化为 0。创建完后，可以以对象
的⽅式或使⽤数组下标索引的⽅式引⽤数组中的元素。</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES2017 最新语法</span>
<span class="token comment">// new Uint8Array(length);</span>
<span class="token keyword">var</span> uint8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
uint8<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>  <span class="token comment">// 负值会被+256</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>uint8<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>uint8<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>uint8<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
<span class="token comment">// new TypedArray(object);</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 31</span>
<span class="token comment">// new Uint8Array(typedArray);</span>
<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 21</span>
<span class="token comment">// new Uint8Array(buffer [, byteOffset [, length]]);</span>
<span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> z <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h5 id="arraybuffer-%E4%B8%8E-typedarray-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><strong>ArrayBuffer</strong> 与 TypedArray 之间的关系<a class="anchor" href="#arraybuffer-%E4%B8%8E-typedarray-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB">§</a></h5>
<p>ArrayBuffer 本身只是⼀⾏ 0 和 1 串  ，TypedArray区分分割长度</p>
<h5 id="blob-%E4%B8%8Earraybuffer">Blob 与ArrayBuffer<a class="anchor" href="#blob-%E4%B8%8Earraybuffer">§</a></h5>
<p>ArrayBuffer 对象⽤于表示通⽤的，固定⻓度的原始⼆进制数据缓冲区，存在内存中的  。</p>
<p>Blob 类型的对象表示不可变的类似⽂件对象的原始数据。  不⼀定是 JavaScript 原⽣格式的数据，位于磁盘、⾼速缓存内存和其他不可
⽤的位置。</p>
<p><strong>互转</strong></p>
<p>FileReader 的 readAsArrayBuffer()</p>
<p>new Blob([new Uint8Array(data]);</p>
<h4 id="dataview">DataView<a class="anchor" href="#dataview">§</a></h4>
<pre class="language-autoit"><code class="language-autoit">new <span class="token function">DataView</span><span class="token punctuation">(</span>buffer <span class="token punctuation">[</span><span class="token punctuation">,</span> byteOffset <span class="token punctuation">[</span><span class="token punctuation">,</span> byteLength<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> buffer   从 ArrayBuffer读取时的偏移字节⻓度起始<span class="token punctuation">,</span>  <span class="token operator">/</span><span class="token operator">/</span> ArrayBuffer 或 SharedArrayBuffer 对象的字节⻓度
</code></pre>
<p>属性 buffer   btyeLength  btyeOffest</p>
<p>方法 getInt8()、 getUint8()、 setInt8() 和 setUint8()</p></article></div><aside class="main_toc_container nav_link_container"><div class="main_toc"><nav class="toc"><ol><li><a href="#%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86blob--arraybuffer">图片处理Blob  ArrayBuffer</a><ol><li><a href="#%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87">本地图片</a></li><li><a href="#%E8%BF%9C%E7%A8%8B%E5%9B%BE%E7%89%87-%E5%9B%BE%E7%89%87%E9%A2%84%E8%A7%88">远程图片-图片预览</a><ol></ol></li></ol></li></ol></nav></div></aside></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><div class="tools flex_center hide_on_mobile"><a class="czs-angle-up-l button" href="#" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></a></div><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>