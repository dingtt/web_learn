<!doctype html><html class="" data-reactroot=""><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"/>
<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="description" content="前端笔记"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/>
<title data-react-helmet="true">webpack的使用 · Ding前端笔记</title>
<link data-react-helmet="true" rel="stylesheet" href="/assets/index.css"/><link data-react-helmet="true" id="prismTheme" rel="stylesheet" href="/assets/prism.css"/>
<script data-react-helmet="true" >
    const shouldSetIsDark = document.cookie.includes('is_dark=1') ? true : document.cookie.includes('is_dark=0') ? false : window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (shouldSetIsDark) {
      document.documentElement.classList.add('is_dark');
      document.getElementById('prismTheme').href = "/assets/prism_tomorrow.css";
    }
  </script>
</head><body><header><h1 class="hide_on_mobile"><a href="/">Ding前端笔记</a></h1><nav><ul><li class="show_on_mobile flex_center"><a class="czs-menu-l" href="#" style="background-image:url(&quot;/assets/czs-menu-l.svg&quot;)"></a></li><li class="show_on_mobile"><h1 class="mobile_title"><a href="/">Ding前端笔记</a></h1></li><li style="flex-grow:1"></li><li class="toggle_dark flex_center"><span class="czs-sun" style="background-image:url(&quot;/assets/czs-sun.svg&quot;)"></span><span class="czs-sun-l" style="background-image:url(&quot;/assets/czs-sun-l.svg&quot;)"></span><span class="czs-moon" style="background-image:url(&quot;/assets/czs-moon.svg&quot;)"></span><span class="czs-moon-l" style="background-image:url(&quot;/assets/czs-moon-l.svg&quot;)"></span></li></ul></nav></header><aside class="sidebar"><ol class="list_style_none"><li class=""><a href="/index.html" class="nav_link">Hello world</a></li><li class="unfold"><a href="/WebAPI/README.md" class="nav_link">WebAPI/README.md<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"></ol></li><li class="unfold"><a href="/HTTP/index.html" class="nav_link">HTTP协议与浏览器<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/HTTP/browser.html" class="nav_link">浏览器</a></li><li class=""><a href="/HTTP/HTTP.html" class="nav_link">HTTP协议请求方法和状态码</a></li><li class=""><a href="/HTTP/internet-hardware.html" class="nav_link">网络硬件</a></li></ol></li><li class="unfold"><a href="/js/todo.md" class="nav_link">js/todo.md<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/js/basics.html" class="nav_link">JavaScript基础</a></li><li class=""><a href="/js/Object.html" class="nav_link">基础</a></li><li class=""><a href="/js/context.html" class="nav_link">执行上下文</a></li><li class=""><a href="/js/closure.html" class="nav_link">闭包和面向对象</a></li><li class=""><a href="/js/regex.html" class="nav_link">正则</a></li><li class=""><a href="/js/algo.html" class="nav_link">算法</a></li><li class=""><a href="/js/design-patterns.html" class="nav_link">JS设计模式</a></li></ol></li><li class="unfold"><a href="/TS/index.html" class="nav_link">TS<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/TS/basics.html" class="nav_link">TS基础</a></li><li class=""><a href="/TS/enum.html" class="nav_link">TS枚举 类型 接口 泛型</a></li></ol></li><li class="unfold"><a href="/vue/index.html" class="nav_link">Vue<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/vue/vue-skills.html" class="nav_link">Vue开发技巧</a></li><li class=""><a href="/vue/vue-communication.html" class="nav_link">Vue组件通信</a></li><li class=""><a href="/vue/vue-router/vue-router.html" class="nav_link">Vue路由</a></li></ol></li><li class=""><a href="/react/lifecycle.html" class="nav_link">React的生命周期</a></li><li class="unfold"><a href="/webpack/index.html" class="nav_link">Webpack<span class="czs-angle-up-l" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></span><span class="czs-angle-down-l" style="background-image:url(&quot;/assets/czs-angle-down-l.svg&quot;)"></span></a><ol class="list_style_none" style="height:auto"><li class=""><a href="/webpack/webpack-use.html" class="nav_link active">webpack的使用</a></li><li class=""><a href="/webpack/webpack-principle.html" class="nav_link">Webpack打包原理解析</a></li><li class=""><a href="/webpack/webpack-dev-config.html" class="nav_link">生产环境配置</a></li><li class=""><a href="/webpack/webpack-custom-loader.html" class="nav_link">实现自己的loader</a></li><li class=""><a href="/webpack/webpack-custom-plugin.html" class="nav_link">实现自己的plugin</a></li><li class=""><a href="/webpack/webpack-split-chunks.html" class="nav_link">webpack代码分片</a></li><li class=""><a href="/webpack/webpack-dev-server-hmr.html" class="nav_link">webpack-dev-server 与 HMR</a></li></ol></li><li class=""><a href="/web-monitor/web-monitor.html" class="nav_link">前端监控简介</a></li><li class=""><a href="/git/git.html" class="nav_link">Git使用</a></li></ol></aside><section class="main"><div class="main_article"><article><h1>webpack的使用</h1>
<h2 id="%E6%A8%A1%E5%9D%97%E5%8C%96">模块化<a class="anchor" href="#%E6%A8%A1%E5%9D%97%E5%8C%96">§</a></h2>
<p>传统的script标签引入js，需要手动维护加载顺序，隐式依赖不容易被发现，每个script的src都意味着一次http请求，顶层作用域即全局作用域，不加限制容易导致全局变量污染。</p>
<p>模块化，通过倒入导入清晰展现依赖关系，从而借助工具来进行打包合并资源文件，多个模块之间的作用域是隔离的。</p>
<p>ES6模块标准以得到大部分浏览器支持，但是无法使用code splitting 和 tree shaing，大多数的npm模块还是CommonJS的格式，浏览器不支持。</p>
<p>打包工具，Webpack，Parcel，Rollup</p>
<h2 id="%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">安装和使用<a class="anchor" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">§</a></h2>
<p>webpack是一个模块打包工具，可以识别出引入模块的语法</p>
<ul>
<li>默认支持多种模块标准，包括AMD，CommonJS，以及ES6模块</li>
<li>完备的代码分割（code splitting）解决方案</li>
<li>可以处理各种类型的资源</li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 局部安装 </span>
npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">-</span><span class="token constant">D</span> <span class="token comment">//webpack-cli 可以帮助我们在命令⾏行行⾥里里使⽤用npx ,webpack等相关指令</span>
npx webpack <span class="token operator">-</span>v <span class="token comment">// npx帮助我们在项⽬目中的node_modules⾥里里查找webpack</span>

npx webpack <span class="token comment">// 使用默认配置文件</span>
npx webpack <span class="token operator">--</span>config webpackconfig<span class="token punctuation">.</span><span class="token property-access">js</span> <span class="token comment">//指定webpack使⽤用webpackconfig.js⽂文件来作为 配置⽂文件并执⾏行行</span>
</code></pre>
<p><em>4.X版本之后需要单独安装webpack-cli</em></p>
<p>scripts是npm提供的脚本命令功能</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"build"</span><span class="token operator">:</span> <span class="token string">"webpack --mode production"</span> <span class="token comment">// 有npm run 时无需npx</span>
<span class="token punctuation">}</span>
</code></pre>
<p>全局安装可以直接运行 <code>webpack --mode production</code>，非全局安装需要使用<code>npm run build</code>，通过npm寻找命令执行</p>
<p>默认的配置文件为 webpack.config.js，webpack运行时会读取目录下的该文件</p>
<p>不同项目使用的webpack版本可能不一致，所以不推荐全局安装</p>
<h2 id="webpack%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">Webpack的核心概念<a class="anchor" href="#webpack%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">§</a></h2>
<h3 id="%E5%85%A5%E5%8F%A3">入口<a class="anchor" href="#%E5%85%A5%E5%8F%A3">§</a></h3>
<p>配置入口文件，即webpack构建的入口，会从它开始依赖分析进行打包。打包结果默认放在当前目录下的dist目录，打包的模块名是main.js</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 直接字符串</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  context<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 路径前缀</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/main.js'</span> <span class="token comment">// 字符串类型入口</span>
  <span class="token comment">// entry: ['./src.main.js', './src/.js']</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span> 
<span class="token comment">// 数组类型入口 </span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-polyfill'</span><span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">]</span>
  <span class="token comment">// 传入一个数组的作用是将做个资源预先合并，在打包时Webpack会将数组的最后一个元素作为实际的入口路径，相当于index.js中 import('babel-polyfill')</span>
  
<span class="token punctuation">}</span>
<span class="token comment">//  对象类型入口 单入口</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    main<span class="token operator">:</span> <span class="token string">'./src/main.js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 对象类型入口 多入口</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  enrty<span class="token operator">:</span> <span class="token punctuation">{</span>
    admin<span class="token operator">:</span> <span class="token string">'./src/admin.js'</span><span class="token punctuation">,</span> <span class="token comment">// chunk name 为admin  这里后面也可以用字符串或数组，单不能定义chunk name</span>
    index<span class="token operator">:</span> <span class="token string">'./src/index.js'</span> <span class="token comment">// chunk  name 为index</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 函数类型入口 使用函数返回上面任意一种配置  函数的好处在于可以动态计算，还支持返回promise对象来进行异步操作</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">entry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    index<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'babel-polyfill'</span><span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="output">output<a class="anchor" href="#output">§</a></h3>
<p>打包后的文件位置</p>
<pre class="language-javascript"><code class="language-javascript">output<span class="token operator">:</span> <span class="token punctuation">{</span>
  pubilcPath<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 用来指定资源的请求位置，</span>
  <span class="token comment">// 可以使用相对HTML的路径， '' ,'./js', './static', '../assets'</span>
  <span class="token comment">// 相对'/'的路径（相对当前页面host name） '/' '/js' '/dist'</span>
  <span class="token comment">// 以及CDN路径</span>
  filename<span class="token operator">:</span> <span class="token string">'main.js'</span><span class="token punctuation">,</span> <span class="token comment">// 这里支持路径，不存在将创建</span>
  <span class="token comment">// filename: '[name]_[hash].[ext]' // </span>
  <span class="token comment">// 绝对路径</span>
  path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>_dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span> <span class="token comment">// path指资源的输出位置，必须是绝对路径</span>
  <span class="token comment">// __dirname Node.js内置变量，值为当前文件所在的绝对路径</span>
  <span class="token comment">// path.resolve拼装函数  / ./ ../</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>
<p>[hash] Webpack此次打包所有资源生成的hash</p>
</li>
<li>
<p>[chunkhash] 当前chunk内容的hash</p>
</li>
<li>
<p>[id] 当前chunk的id</p>
</li>
<li>
<p>[query] filename配置项中的query</p>
</li>
</ul>
<h3 id="loader">loader<a class="anchor" href="#loader">§</a></h3>
<p>loader是webpack中处理多种文件格式的机制，负责把某种文件格式的内容转换成webpack可以支持打包的模块。</p>
<p>loader可以是链式的，接收的可能是工程源文件的字符串，也可能是上个loader转化后的结果字符串、source map，以及AST对象，输出类似。</p>
<pre class="language-javascript"><code class="language-javascript">modules<span class="token punctuation">.</span><span class="token keyword module">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  modules<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span><span class="token punctuation">[</span> <span class="token comment">// 模块的处理规则</span>
        <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.xxx$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>  <span class="token comment">// 匹配文件，通常是匹配文件后缀  接收正则表达式，或元素为正则表达式的数组</span>
        enforce<span class="token operator">:</span><span class="token string">'pre'</span><span class="token punctuation">,</span> <span class="token comment">// pre所有loader之前，比如eslint-loader； post所有loader之后，入babel-loader；不配置该项为normal；inline已不推荐 </span>
        <span class="token comment">// noParse: /jquery|lodash/, // 正则表达式 配置哪些模块文件的内容不需要进行解析，文件中不能使用 `import`、`require`、`define` 等导入机制,适合一些**不需要解析依赖（即无依赖）** 的第三方大型类库等，</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span>
          path<span class="token punctuation">.</span><span class="token method function property-access">recolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span> <span class="token comment">// 指定哪些路径下的该类文件需要处理</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        exclude<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 排除目录，exclude和include同时存在，exclude优先级更高</span>
        <span class="token comment">// /node_modules\/(?!(foo|bar)\/).*/ // 排除 排除中的目录的模块，从而设置对该模块生效</span>
        <span class="token comment">// use: 'xxx-loader', </span>
        <span class="token comment">// use: ['xxx-loader', 'yyy-loader'] // loader有顺序，从后向前，从下向上</span>
        use<span class="token operator">:</span> <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">'xxx-load'</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 可以传入配置项，还可以在loader名称后使用query的方式传入</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 还可以写成如下格式，resource 和issuer</span>
        <span class="token comment">// resource: {</span>
        <span class="token comment">//  test:'',</span>
        <span class="token comment">//  include:''</span>
        <span class="token comment">// },</span>
        <span class="token comment">// issuer: { // 对于引用模块的文件生效</span>
        <span class="token comment">//  test:/\.js$/,</span>
         <span class="token comment">// include:'src/pages' // 只有该目录下的，同上类型文件，引入的符合test的模块，才会进行loader处理</span>
        <span class="token comment">//  exclude:/node_modules/ // 排除该目录下，同上类型的文件，其他文件引入的符合test的模块</span>
        <span class="token comment">// }</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>所有的 loader 按照<strong>前置 -&gt; 行内 -&gt; 普通 -&gt; 后置</strong>的顺序执行</p>
<h3 id="loader%E8%A7%84%E5%88%99">loader规则<a class="anchor" href="#loader%E8%A7%84%E5%88%99">§</a></h3>
<ul>
<li><code>{ test: ... }</code> 匹配特定条件</li>
<li><code>{ include: ... }</code> 匹配特定路径</li>
<li><code>{ exclude: ... }</code> 排除特定路径</li>
<li><code>{ and: [...] }</code>必须匹配数组中所有条件</li>
<li><code>{ or: [...] }</code> 匹配数组中任意一个条件</li>
<li><code>{ not: [...] }</code> 排除匹配数组中所有条件</li>
</ul>
<p>上述的所谓条件的值可以是：</p>
<ul>
<li>字符串：必须以提供的字符串开始，所以是字符串的话，这里我们需要提供绝对路径</li>
<li>正则表达式：调用正则的 <code>test</code> 方法来判断匹配</li>
<li>函数：(path) =&gt; boolean，返回 <code>true</code> 表示匹配</li>
<li>数组：至少包含一个条件的数组</li>
<li>对象：匹配所有属性值的条件</li>
</ul>
<h3 id="module-type">module type<a class="anchor" href="#module-type">§</a></h3>
<p>webpack 4.x 版本强化了 module type，即模块类型的概念，不同的模块类型类似于配置了不同的 loader，webpack 会有针对性地进行处理，现阶段实现了以下 5 种模块类型。</p>
<ul>
<li><code>javascript/auto</code>：即 webpack 3 默认的类型，支持现有的各种 JS 代码模块类型 —— CommonJS、AMD、ESM</li>
<li><code>javascript/esm</code>：ECMAScript modules，其他模块系统，例如 CommonJS 或者 AMD 等不支持，是 <code>.mjs</code> 文件的默认类型</li>
<li><code>javascript/dynamic</code>：CommonJS 和 AMD，排除 ESM</li>
<li><code>javascript/json</code>：JSON 格式数据，<code>require</code> 或者 <code>import</code> 都可以引入，是 <code>.json</code> 文件的默认类型</li>
<li><code>webassembly/experimental</code>：WebAssembly modules，当前还处于试验阶段，是 <code>.wasm</code> 文件的默认类型</li>
</ul>
<pre class="language-autoit"><code class="language-autoit">{
  test<span class="token punctuation">:</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>js<span class="token operator">/</span><span class="token punctuation">,</span>
  include<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">'javascript/esm'</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 这里指定模块类型
}<span class="token punctuation">,</span>
</code></pre>
<h3 id="%E5%B8%B8%E7%94%A8loader">常用loader<a class="anchor" href="#%E5%B8%B8%E7%94%A8loader">§</a></h3>
<h4 id="babel-loader-%E5%B0%86es6%E8%BD%AC%E5%8C%96%E4%B8%BAes5">babel-loader 将ES6转化为ES5<a class="anchor" href="#babel-loader-%E5%B0%86es6%E8%BD%AC%E5%8C%96%E4%B8%BAes5">§</a></h4>
<p>babel-loader需要设置exclude排除node_modules</p>
<p>babel-loader本身添加了cacheDirectory配置项，缓存机制在重复打包未改变过的模块时防止二次编译</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 在dev模式中，默认开启，关闭的话 可以在配置⽂文件⾥里里</span>

<span class="token comment">//babel-loader是webpack 与 babel的通信桥梁梁，不不会做把es6转成es5的⼯工作，这部分⼯工作需要⽤用 到@babel/preset-env来做</span>
<span class="token comment">//@babel/preset-env⾥里里包含了了es6转es5的转换规则</span>

</code></pre>
<pre class="language-javascript"><code class="language-javascript">rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
        <span class="token string">'env'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
          modules<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 阻止@babel/preset-env会ES6 转化为CommonJS的形式（会导致webpack中的tree-shaking失效）</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>babel-loader 支持从 .babelrc文件读取babel配置</p>
<h4 id="babelpolyfill">@babel/polyfill<a class="anchor" href="#babelpolyfill">§</a></h4>
<p>把es的新特性都引入，例如Promise等，默认会把所有特性都注入到<strong>全局变量</strong></p>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">/</span> 按需引入的设置，可以配置到<span class="token punctuation">.</span>babelrc里
options<span class="token punctuation">:</span> {
  presets<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>
     {
      targets<span class="token punctuation">:</span> {
       edge<span class="token punctuation">:</span><span class="token string">"17"</span><span class="token punctuation">,</span>
       firefix<span class="token punctuation">:</span><span class="token string">"60"</span><span class="token punctuation">,</span>
       chrome<span class="token punctuation">:</span><span class="token string">"66"</span><span class="token punctuation">,</span>
       safari<span class="token punctuation">:</span><span class="token string">"11.1"</span><span class="token punctuation">,</span>
      }<span class="token punctuation">,</span>
      useBuiltIns<span class="token punctuation">:</span> <span class="token string">'usage'</span> <span class="token operator">/</span><span class="token operator">/</span> 按需引入<span class="token punctuation">,</span>useBuiltIns 选项是 babel <span class="token number">7</span> 的新功能<span class="token punctuation">,</span>告诉 babel 如何配置                      <span class="token operator">/</span><span class="token operator">/</span> <span class="token variable">@babel</span><span class="token operator">/</span>polyfill  entry 需要在entry里引入import <span class="token string">"@babel/polyfill"</span>，usage 不需要import
     }
     <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span>  <span class="token operator">/</span><span class="token operator">/</span> 打包react选安装配置的
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
}
</code></pre>
<h4 id="babelplugin-tranform-runtime">@babel/plugin-tranform-runtime<a class="anchor" href="#babelplugin-tranform-runtime">§</a></h4>
<p>闭包方式引入</p>
<pre class="language-autoit"><code class="language-autoit">npm i <span class="token variable">@babel</span><span class="token operator">/</span>plugin<span class="token operator">-</span>tranform<span class="token operator">-</span>runtime <span class="token operator">-</span>S
npm i <span class="token variable">@babel</span><span class="token operator">/</span>runntime <span class="token operator">-</span>S
</code></pre>
<pre class="language-autoit"><code class="language-autoit"><span class="token operator">/</span><span class="token operator">/</span> 注释preset<span class="token operator">-</span>env 写入配置文件<span class="token punctuation">.</span>babelrc
{
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">[</span>
     <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>
     {
       <span class="token string">"absoluteRuntime"</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        
       <span class="token string">"corejs"</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> 
        <span class="token string">"helpers"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        
        <span class="token string">"regenerator"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        
        <span class="token string">"useESModules"</span><span class="token punctuation">:</span> <span class="token boolean">false</span> 
     }
   <span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
}
</code></pre>
<h4 id="ts-loader">ts-loader<a class="anchor" href="#ts-loader">§</a></h4>
<p>将Typescript 转换未javascript</p>
<pre class="language-autoit"><code class="language-autoit">rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  {
    test<span class="token punctuation">:</span> <span class="token operator">/</span>\<span class="token punctuation">.</span>ts$<span class="token operator">/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token string">'ts-loader'</span>
  }
<span class="token punctuation">]</span>
</code></pre>
<p>TS的配置在工程目录下的tscofig.json中</p>
<pre class="language-autoit"><code class="language-autoit">{
  <span class="token string">"compilerOptions"</span><span class="token punctuation">:</span> {
  	<span class="token string">"target"</span><span class="token punctuation">:</span> <span class="token string">'es5'</span><span class="token punctuation">,</span>
  	<span class="token string">"sourceMap"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>
  }
}
</code></pre>
<h4 id="html-loader">html-loader<a class="anchor" href="#html-loader">§</a></h4>
<p>用于将HTML文件转化为字符串并进行格式化</p>
<h5 id="handlebars-loader-%E5%A4%84%E7%90%86handlebars%E6%A8%A1%E6%9D%BF">handlebars-loader 处理handlebars模板<a class="anchor" href="#handlebars-loader-%E5%A4%84%E7%90%86handlebars%E6%A8%A1%E6%9D%BF">§</a></h5>
<p>handlebars文件加载后得到一个函数，函数接收变量对象作为参数，可返回最终的字符串</p>
<h4 id="file-loader-%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97">file-loader 处理静态资源模块<a class="anchor" href="#file-loader-%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97">§</a></h4>
<p><strong>作用</strong></p>
<p>把打包入口中识别处理的资源模块，从源代码移动到输出目录，并且返回一个地址名称</p>
<p><strong>应用场景</strong></p>
<p>txt，svg，md，csv，excel，图片等资源</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.(png|jpe?g|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
      	loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
      	options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 额外的配置，资源名称输出目录等</span>
      	  name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span> <span class="token comment">// [name]原来的资源文件名，文件hash，[ext]扩展名</span>
      	  publicPath<span class="token operator">:</span><span class="token string">'imgages/'</span> <span class="token comment">// 输出到的位置 file-loader中的publicPath会覆盖Webpack中的publicPath</span>
      	<span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="url-loader-%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97">url-loader 处理静态资源模块<a class="anchor" href="#url-loader-%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97">§</a></h4>
<p>url-loader可以处理file-loader所有的事情，不同的地方在于，url-loader可以把图片转换成base64格式。这种转换仅适合于较小的图片，可以配置转换阈值。</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.(png|jpe?g|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
      	loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        <span class="token comment">// include: [], // 最好加上include范围，提高执行效率</span>
      	options<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 配置资源名称输出目录等</span>
      	  name<span class="token operator">:</span> <span class="token string">'[name]_[hash].[ext]'</span><span class="token punctuation">,</span> <span class="token comment">// 原来的资源文件名，文件hash，扩展名</span>
      	  publicPath<span class="token operator">:</span><span class="token string">'imgages/'</span> <span class="token comment">// 输出到的位置</span>
      	  limit<span class="token operator">:</span> <span class="token number">10000</span> <span class="token comment">// limit默认值是10000，小于8kb的图片才会被编译</span>
      	<span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>注：url-loader默认只会处理html和css中的图片，JS中可以通过import引入图片通过一个变量接收</p>
<h4 id="%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86loader">样式处理loader<a class="anchor" href="#%E6%A0%B7%E5%BC%8F%E5%A4%84%E7%90%86loader">§</a></h4>
<p>css-loader 分析各css模块之间的关系，合成一个css</p>
<p>style-loader 会把css-loader生成的内容，以style挂载到页面的header部分</p>
<p>sass-loader 把sass语法转换成css，依赖node-sass模块 <code>npm install sass-loader node-sass -D</code></p>
<p>less-loader</p>
<p>postcss-loader post-css需要有单独的配置文件 postcss-loader</p>
<pre class="language-autoit"><code class="language-autoit">{
  test<span class="token punctuation">:</span> <span class="token operator">/</span><span class="token operator">^</span>\<span class="token punctuation">.</span>scss$<span class="token operator">/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> 
  {loader<span class="token punctuation">:</span><span class="token string">'css-loader'</span><span class="token punctuation">,</span> 
  options<span class="token punctuation">:</span> {
  	 minimize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 使用 css 的压缩功能<span class="token punctuation">,</span>css<span class="token operator">-</span>loader 是使用cssnano来压缩代码的，`minimize` 字段也可以配置为一个对象，来将相关配置传递给 cssnano
  }}<span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span>
}
</code></pre>
<h4 id="image-webpack-loader%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87">image-webpack-loader压缩图片<a class="anchor" href="#image-webpack-loader%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87">§</a></h4>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.*\.(gif|png|jpe?g|svg|webp)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">'image-webpack-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 压缩 jpeg 的配置</span>
                progressive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                quality<span class="token operator">:</span> <span class="token number">65</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              optipng<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 imagemin-optipng 压缩 png，enable: false 为关闭</span>
                enabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              pngquant<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 使用 imagemin-pngquant 压缩 png</span>
                quality<span class="token operator">:</span> <span class="token string">'65-90'</span><span class="token punctuation">,</span>
                speed<span class="token operator">:</span> <span class="token number">4</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 压缩 gif 的配置</span>
                interlaced<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              webp<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 开启 webp，会把 jpg 和 png 图片压缩为 webp 格式</span>
                quality<span class="token operator">:</span> <span class="token number">75</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>image-webpack-loader 的压缩是使用 <a href="https://github.com/imagemin">imagemin</a> 提供的一系列图片压缩类库来处理的</p>
<h4 id="vue%E6%A8%A1%E6%9D%BF%E8%A7%A3%E6%9E%90">Vue模板解析<a class="anchor" href="#vue%E6%A8%A1%E6%9D%BF%E8%A7%A3%E6%9E%90">§</a></h4>
<p>vue-loader   还依赖 vue-tempalte-compiler css-loader  , CSS样式的预处理器</p>
<pre class="language-autoit"><code class="language-autoit">rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  {
  test<span class="token punctuation">:</span> <span class="token operator">/</span><span class="token operator">^</span>\<span class="token punctuation">.</span>vue$<span class="token operator">/</span>
  use<span class="token punctuation">:</span><span class="token string">'vue-loader'</span>
  }
<span class="token punctuation">]</span>
</code></pre>
<h4 id="css-modules">CSS Modules<a class="anchor" href="#css-modules">§</a></h4>
<p>每个css文件都有单独的作用域，对css进行依赖关系，可以通过相对路径引入css文件，可以通过composes轻松复用其他CSS模块</p>
<p>只需要开启css-loader配置项中的modules : true</p>
<pre class="language-autoit"><code class="language-autoit">options<span class="token punctuation">:</span>{
  modules<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  localIdentName<span class="token punctuation">:</span><span class="token string">'[name]_[local]_[hash:base64:5]'</span> <span class="token operator">/</span><span class="token operator">/</span> 模块名 选择符 <span class="token number">5</span>位哈希
}
</code></pre>
<p>使用CSSmodules时css文件会导出一个对象，我们需要把对象的属性添加到html标签上</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// style.css</span>
<span class="token punctuation">.</span><span class="token property-access">title</span> <span class="token punctuation">{</span>
  color<span class="token operator">:</span>#f938ab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// app.js</span>
<span class="token keyword module">import</span> <span class="token imports">styles</span> <span class="token keyword module">from</span> <span class="token string">'./style.css'</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;h1 calss={$styles.title}>优点复杂&lt;/h1></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre>
<h3 id="%E5%B8%B8%E7%94%A8plugin">常用plugin<a class="anchor" href="#%E5%B8%B8%E7%94%A8plugin">§</a></h3>
<h4 id="html-webpack-plugin">html-webpack-plugin<a class="anchor" href="#html-webpack-plugin">§</a></h4>
<p>会自动把打包处理的资源名放入到生成的index.html中，支持传入html模板</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 配置输出文件名和路径</span>
      template<span class="token operator">:</span> <span class="token string">'public/index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 配置文件模板</span>
      minify<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 压缩 HTML 的配置,minify下的配置项直接透传给 html-minifier</span>
        minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 压缩 HTML 中出现的 CSS 代码</span>
        minifyJS<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 压缩 HTML 中出现的 JS 代码</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre>
<p><em>webpack 4.x 版本运行时，mode 为 production 即会启动压缩 JS 代码的插件</em></p>
<h4 id="extract-text-webpack-plugin-%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86webpack4%E5%89%8D">extract-text-webpack-plugin 样式文件处理webpack4前<a class="anchor" href="#extract-text-webpack-plugin-%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86webpack4%E5%89%8D">§</a></h4>
<p>样式的提取是以资源入口开始的整个chunk为单位的，chunk是一组具有依赖关系的模块的封装，多个构建入口，extract-text-webpack-plugin 会为每一个入口创建单独分离的文件。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token maybe-class-name">ExtractTextPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 因为这个插件需要干涉模块转换的内容，所以需要使用它对应的 loader</span>
        use<span class="token operator">:</span> <span class="token maybe-class-name">ExtractTextPlugin</span><span class="token punctuation">.</span><span class="token method function property-access">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span> 
          fallback<span class="token operator">:</span> <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
          use<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 引入插件，配置文件名，这里同样可以使用 [hash]</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token string">'index.css'</span><span class="token punctuation">)</span>
    <span class="token comment">//  new ExtractTextPlugin('[name].css')</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="mini-css-extract-plugin">mini-css-extract-plugin<a class="anchor" href="#mini-css-extract-plugin">§</a></h4>
<p>支持按需加载，</p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token comment">// 插件需要干涉模块转换的内容，所以需要使用它对应的 loader</span>
          loader<span class="token operator">:</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            publicPath<span class="token operator">:</span><span class="token string">'../'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'css-loader'</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
plugins<span class="token operator">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span> <span class="token comment">// chunkname 对英entry里的key  同步加载的css资源名</span>
    chunkFilename<span class="token operator">:</span> <span class="token string">'[id].css'</span> <span class="token comment">// 指定异步加载的css资源名</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<h4 id="css-sprites-%E7%B2%BE%E7%81%B5%E5%9B%BE">CSS Sprites 精灵图<a class="anchor" href="#css-sprites-%E7%B2%BE%E7%81%B5%E5%9B%BE">§</a></h4>
<p><a href="https://github.com/mixtur/webpack-spritesmith">webpack-spritesmith</a> 或者 <a href="https://github.com/kezoo/sprite-webpack-plugin">sprite-webpack-plugin</a></p>
<pre class="language-javascript"><code class="language-javascript">module<span class="token operator">:</span> <span class="token punctuation">{</span>
  loaders<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ... 这里需要有处理图片的 loader，如 file-loader</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
  modules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'node_modules'</span><span class="token punctuation">,</span> 
    <span class="token string">'spritesmith-generated'</span><span class="token punctuation">,</span> <span class="token comment">// webpack-spritesmith 生成所需文件的目录</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">SpritesmithPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    src<span class="token operator">:</span> <span class="token punctuation">{</span>
      cwd<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/ico'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 多个图片所在的目录</span>
      glob<span class="token operator">:</span> <span class="token string">'*.png'</span> <span class="token comment">// 匹配图片的路径</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 生成最终图片的路径</span>
      image<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/spritesmith-generated/sprite.png'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token comment">// 生成所需 SASS/LESS/Stylus mixins 代码，我们使用 Stylus 预处理器做例子</span>
      css<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/spritesmith-generated/sprite.styl'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    apiOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      cssImageRef<span class="token operator">:</span> <span class="token string">"~sprite.png"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>CSS文件里引入</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token variable">@import</span> <span class="token string">'~sprite.styl'</span>

<span class="token punctuation">.</span>close<span class="token operator">-</span>button
    <span class="token function">sprite</span><span class="token punctuation">(</span><span class="token variable">$close</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>open<span class="token operator">-</span>button
    <span class="token function">sprite</span><span class="token punctuation">(</span><span class="token variable">$open</span><span class="token punctuation">)</span>
</code></pre>
<p>webpack4.X中的精灵图需要postcss和 <a href="https://github.com/2createStudio/postcss-sprites">postcss-sprites</a> 才能实现</p>
<h4 id="defineplugin">definePlugin<a class="anchor" href="#defineplugin">§</a></h4>
<p>DefinePlugin 是 webpack 内置的插件，可以使用 <code>webpack.DefinePlugin</code> 直接获取。</p>
<ul>
<li>如果配置的值是字符串，那么整个字符串会被当成代码片段来执行，其结果作为最终变量的值，如上面的 <code>&quot;1+1&quot;</code>，最后的结果是 <code>2</code></li>
<li>如果配置的值不是字符串，也不是一个对象字面量，那么该值会被转为一个字符串，如 <code>true</code>，最后的结果是 <code>'true'</code></li>
<li>如果配置的是一个对象字面量，那么该对象的所有 key 会以同样的方式去定义</li>
</ul>
<p>需要使用JSON.stringfy(), <code>JSON.stringify(true)</code> 的结果是 <code>'true'</code></p>
<blockquote>
<p>建议使用 process.env.NODE_ENV: ... 的方式来定义 process.env.NODE_ENV，而不是使用 process: { env: { NODE_ENV: ... } } 的方式，因为这样会覆盖掉 process 这个对象，可能会对其他代码造成影响。</p>
</blockquote>
<h4 id="provideplugin">ProvidePlugin<a class="anchor" href="#provideplugin">§</a></h4>
<p>ProvidePlugin 也是一个 webpack 内置的插件，我们可以直接使用 <code>webpack.ProvidePlugin</code> 来获取。</p>
<p>该组件用于引用某些模块作为应用运行时的变量，从而不必每次都用 <code>require</code> 或者 <code>import</code>，其用法相对简单：</p>
<pre class="language-autoit"><code class="language-autoit">new webpack<span class="token punctuation">.</span><span class="token function">ProvidePlugin</span><span class="token punctuation">(</span>{
  identifier<span class="token punctuation">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
}<span class="token punctuation">)</span>

<span class="token operator">/</span><span class="token operator">/</span> 或者
new webpack<span class="token punctuation">.</span><span class="token function">ProvidePlugin</span><span class="token punctuation">(</span>{
  identifier<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'property'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 即引用 module 下的 property，类似 import { property } from <span class="token string">'module'</span>
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
}<span class="token punctuation">)</span>

</code></pre>
<p>在你的代码中，当 <code>identifier</code> 被当作未赋值的变量时，module 就会被自动加载了，而 <code>identifier</code> 这个变量即 module 对外暴露的内容。</p>
<p>注意，如果是 ES 的 <code>default export</code>，那么你需要指定模块的 <code>default</code> 属性：<code>identifier: ['module', 'default']</code></p>
<h4 id="ignoreplugin">IgnorePlugin<a class="anchor" href="#ignoreplugin">§</a></h4>
<p>IgnorePlugin 和 ProvidePlugin 一样，也是一个 webpack 内置的插件，可以直接使用 <code>webpack.IgnorePlugin</code> 来获取。</p>
<p>这个插件用于忽略某些特定的模块，让 webpack 不把这些指定的模块打包进去。例如我们使用 <a href="http://momentjs.com/">moment.js</a>，直接引用后，里边有大量的 i18n 的代码，导致最后打包出来的文件比较大，而实际场景并不需要这些 i18n 的代码，这时我们可以使用 IgnorePlugin 来忽略掉这些代码文件，配置如下：</p>
<pre class="language-autoit"><code class="language-autoit">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> {
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    new webpack<span class="token punctuation">.</span><span class="token function">IgnorePlugin</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">^</span>\<span class="token punctuation">.</span>\<span class="token operator">/</span>locale$<span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">/</span>moment$<span class="token operator">/</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
}

</code></pre>
<p>IgnorePlugin 配置的参数有两个，第一个是匹配引入模块路径的正则表达式，第二个是匹配模块的对应上下文，即所在目录名。</p>
<h4 id="clean-webpack-plugin">clean-webpack-plugin<a class="anchor" href="#clean-webpack-plugin">§</a></h4>
<p>自动清除上次打包目录生成的文件</p>
<h4 id="copy-webpack-plugin">copy-webpack-plugin<a class="anchor" href="#copy-webpack-plugin">§</a></h4>
<pre class="language-autoit"><code class="language-autoit"><span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> {
  <span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    new <span class="token function">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      { from<span class="token punctuation">:</span> <span class="token string">'src/file.txt'</span><span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">:</span> <span class="token string">'build/file.txt'</span><span class="token punctuation">,</span> }<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 顾名思义，from 配置来源，<span class="token keyword">to</span> 配置目标路径
      { from<span class="token punctuation">:</span> <span class="token string">'src/*.ico'</span><span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token punctuation">:</span> <span class="token string">'build/*.ico'</span> }<span class="token punctuation">,</span> <span class="token operator">/</span><span class="token operator">/</span> 配置项可以使用 glob
      <span class="token operator">/</span><span class="token operator">/</span> 可以配置很多项复制规则
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
}
</code></pre>
<h4 id="%E6%A0%B7%E5%BC%8F%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E5%89%8D%E7%BC%80">样式自动添加前缀<a class="anchor" href="#%E6%A0%B7%E5%BC%8F%E8%87%AA%E5%8A%A8%E6%B7%BB%E5%8A%A0%E5%89%8D%E7%BC%80">§</a></h4>
<p>postcss-loader结合autoprefixer 自动添加样式前缀，配置文件postcss.config.js</p>
<pre class="language-autoit"><code class="language-autoit">npm i postcss<span class="token operator">-</span>loader <span class="token operator">-</span>D
</code></pre>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// npm i autoprefixer -D</span>
<span class="token comment">// postcss.config.js</span>
<span class="token keyword">const</span> autoprefixer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      grid<span class="token operator">:</span><span class="token boolean">true</span> <span class="token comment">// 为grid特性添加ie前缀</span>
      browers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">'> 1%'</span><span class="token punctuation">,</span>
        <span class="token string">'last 3 versions'</span><span class="token punctuation">,</span>
        <span class="token string">'android 4.4'</span><span class="token punctuation">,</span>
        <span class="token string">'ie 8'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="stylelint-%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E6%A3%80%E6%9F%A5">stylelint 代码格式检查<a class="anchor" href="#stylelint-%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E6%A3%80%E6%9F%A5">§</a></h4>
<h4 id="cssnext">CSSNext<a class="anchor" href="#cssnext">§</a></h4>
<p>postcss-cssnext</p>
<pre class="language-autoit"><code class="language-autoit"><span class="token function">postcssCssnext</span><span class="token punctuation">(</span>{
  <span class="token operator">/</span><span class="token operator">/</span> 指定所支持的浏览器
  browers<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token string">'> 1%'</span><span class="token punctuation">,</span>
    <span class="token string">'last 2 versions'</span>
  <span class="token punctuation">]</span>
}<span class="token punctuation">)</span>
</code></pre>
<h3 id="sourcemap">sourceMap<a class="anchor" href="#sourcemap">§</a></h3>
<p>源代码于打包后的代码的映射关系</p>
<p>在dev模式中，默认开启，关闭的话 可以在配置件⾥</p>
<pre class="language-autoit"><code class="language-autoit">devtool<span class="token punctuation">:</span><span class="token string">'none'</span> <span class="token operator">/</span><span class="token operator">/</span> eval速度最快 cheap 较快，不管列的报错 module 第三方模块
<span class="token operator">/</span><span class="token operator">/</span> 开发坏境推荐
devtool<span class="token punctuation">:</span><span class="token string">'cheap-module-eval-source-map'</span>
<span class="token operator">/</span><span class="token operator">/</span> 线上坏境推荐
devtool<span class="token punctuation">:</span><span class="token string">'cheap-module-source-map'</span>
</code></pre>
<h2 id="%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96">构建速度优化<a class="anchor" href="#%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96">§</a></h2>
<h3 id="%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%BC%80%E9%94%80">避免不必要的开销<a class="anchor" href="#%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%BC%80%E9%94%80">§</a></h3>
<h3 id="%E5%87%8F%E5%B0%91-resolve-%E8%A7%A3%E6%9E%90">减少 <code>resolve</code> 解析<a class="anchor" href="#%E5%87%8F%E5%B0%91-resolve-%E8%A7%A3%E6%9E%90">§</a></h3>
<p>webpack的resolve设置</p>
<pre class="language-autoit"><code class="language-autoit">resolve<span class="token punctuation">:</span> {
  modules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
   path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span> 使用绝对路径指定node_modules，不做果多查询
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  extensions<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">]</span>， <span class="token operator">/</span><span class="token operator">/</span> 排除不必要的的后缀自动补全，减少文件路径查询工作<span class="token punctuation">,</span>其外的文件可以在编码时指定后缀
  mainFiles<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">/</span> 避免新增默认文件
}
</code></pre>
<p>本地的代码模块，尽可能编写完整的路径，避免使用目录名，webpack不用去多次查询来确定使用哪个文件</p>
<h3 id="%E6%8A%8A-loader-%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E8%8C%83%E5%9B%B4%E7%BC%A9%E5%B0%8F">把 loader 应用的文件范围缩小<a class="anchor" href="#%E6%8A%8A-loader-%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E8%8C%83%E5%9B%B4%E7%BC%A9%E5%B0%8F">§</a></h3>
<p>把 loader 应用的文件范围缩小，限定只在src目录下的文件</p>
<h3 id="%E5%87%8F%E5%B0%91plugins%E7%9A%84%E6%B6%88%E8%80%97">减少Plugins的消耗<a class="anchor" href="#%E5%87%8F%E5%B0%91plugins%E7%9A%84%E6%B6%88%E8%80%97">§</a></h3>
<h3 id="%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9">图片压缩<a class="anchor" href="#%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9">§</a></h3>
<p>构建时压缩 用image-webpack-loader</p>
<p>图片提前先压缩，使用imagemin来压缩图片，只用pre-commit使其在git commit 的适合触发，并且将要提交的文件替换为压缩后的文件。</p>
<h3 id="%E4%BD%BF%E7%94%A8dllplugin%E5%88%86%E7%A6%BB%E4%BB%A3%E7%A0%81">使用DLLPLugin分离代码<a class="anchor" href="#%E4%BD%BF%E7%94%A8dllplugin%E5%88%86%E7%A6%BB%E4%BB%A3%E7%A0%81">§</a></h3>
<p>与splitChunks的区别时，DLLPlugin构建出来的内容无需每次构建的适合都再次构建；公共部分变更时，需要再次执行配置文件构建；分离出来的代码需要手动添加到html或者使用add-assets-webpack-plugin</p></article><div class="prev_next"><a class="prev button" href="/webpack/index.html">«  <!-- -->Webpack</a><a class="next button" href="/webpack/webpack-principle.html">Webpack打包原理解析<!-- -->  »</a></div></div><aside class="main_toc_container nav_link_container"><div class="main_toc"><nav class="toc"><ol><li><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96">模块化</a></li><li><a href="#%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">安装和使用</a></li><li><a href="#webpack%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">Webpack的核心概念</a><ol><li><a href="#%E5%85%A5%E5%8F%A3">入口</a></li><li><a href="#output">output</a></li><li><a href="#loader">loader</a></li><li><a href="#loader%E8%A7%84%E5%88%99">loader规则</a></li><li><a href="#module-type">module type</a></li><li><a href="#%E5%B8%B8%E7%94%A8loader">常用loader</a><ol></ol></li><li><a href="#%E5%B8%B8%E7%94%A8plugin">常用plugin</a><ol></ol></li><li><a href="#sourcemap">sourceMap</a></li></ol></li><li><a href="#%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96">构建速度优化</a><ol><li><a href="#%E9%81%BF%E5%85%8D%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84%E5%BC%80%E9%94%80">避免不必要的开销</a></li><li><a href="#%E5%87%8F%E5%B0%91-resolve-%E8%A7%A3%E6%9E%90">减少 resolve 解析</a></li><li><a href="#%E6%8A%8A-loader-%E5%BA%94%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6%E8%8C%83%E5%9B%B4%E7%BC%A9%E5%B0%8F">把 loader 应用的文件范围缩小</a></li><li><a href="#%E5%87%8F%E5%B0%91plugins%E7%9A%84%E6%B6%88%E8%80%97">减少Plugins的消耗</a></li><li><a href="#%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9">图片压缩</a></li><li><a href="#%E4%BD%BF%E7%94%A8dllplugin%E5%88%86%E7%A6%BB%E4%BB%A3%E7%A0%81">使用DLLPLugin分离代码</a></li></ol></li></ol></nav></div></aside></section><footer>Powered by <a href="https://github.com/xcatliu/pagic" target="_blank">Pagic</a></footer><div class="tools flex_center hide_on_mobile"><a class="czs-angle-up-l button" href="#" style="background-image:url(&quot;/assets/czs-angle-up-l.svg&quot;)"></a></div><script src="https://cdn.pagic.org/react@16.13.1/umd/react.production.min.js"></script><script src="https://cdn.pagic.org/react-dom@16.13.1/umd/react-dom.production.min.js"></script><script type="module" src="/index.js"></script></body></html>