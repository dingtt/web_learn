# 生产环境配置

## 环境变量

sourcemap

cheap-source-map  eval-source-map 简版

hidden-sourece-map  不会在js中添加引用，配合sentry等监控平台使用

nosources-source-map u不显示文件结构

通过nginx设置将.map文件只对固定的ip开放

## 资源压缩

```
// webpack3 使用UglifyJsPlugin
// webpack4
optimization: {
  minimize: true // 如果设置了mode:production ,则无需单独设置
}
```

#### terser-webpack-plugin

```javascript
import TerserWebpackPlugin = require('terser-webpack-plugin')
module.exports = {
  // ...
  optimization: {
    // 覆盖默认设置
    minimizer:[
      new TerserPlugin({
        test: /\.js(\?.*)$/i,
        exclude: /\/excludes/,
        include: /\includes/ ,
        chache: false, // 是否开启缓存
        parallel: false, // 允许多进程，可传入数字
        sourceMap : false, // 是否生成sourceMap
        terserOptions:{  // 压缩配置 是否对变量重命名 是否兼容ie8
          
        }
      })
    ]
  }
}
```

### 压缩CSS

需要用extract-text-webpack-plugin 或者 min-css-extract-plugin先提取css，再使用 optimize-css-assets-webpack-plugin

```javascript
optimization: {
  minimizer: [
   new OptimizeCssAssetsPlugin({
     // 生效范围 只压缩匹配到的css
     assetsNameRegExp: /\.optimize\.css$/g,
     // 压缩处理器 默认为cssnano
     cssProcessor: require('cssnao'),
     // 压缩处理器的配置
     cssProcessorOptions: {discardComments: { removeAll: true }},
     // 是否展示 log
     canPrint: true
   })
  ]
}
```

